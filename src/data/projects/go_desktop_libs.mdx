---
id: go_desktop_libs
title: Go Desktop
description: Библиотеки рабочего стола на Go

status: finished

order: 0

stack:
    - Go
    - GTK3
    - gtk-layer-shell
---

import Ext from '@components/ExternalLink.astro'
import Picture from '@components/Picture.astro'

import bar from '@assets/projects/go_desktop_libs/bar.webp'
import launch from '@assets/projects/go_desktop_libs/launch.webp'
import powermenu from '@assets/projects/go_desktop_libs/powermenu.webp'


# Go Desktop

В феврале 2025 года я начал работать над своей системой виджетов для
Wayland-композиторов. В качестве языка был выбран Go, а тулкитом для
отображения виджетов -- GTK 3.

За это время было разработано несколько библиотек, которые реализуют
необходимый для подобного проекта функционал. Специфика Go в том, что на нём
практически не разрабатываются десктопные приложения -- дальше <abbr
title="Proof of Concept, проверка концепции">PoC</abbr> дело не заходит.
Поэтому часто приходилось изобретать велосипед, реализуя недостающий
функционал по спецификациям.

В сентябре-октябре 2025 года я понял, что выбор языка был ошибкой. Когда речь
заходит о разработке нативных графических приложений, всегда встает вопрос
привязок -- в подавляющем большинстве случаев, так или иначе, используется
библиотеки языка C, предварительно обернутые для использования в другом языке.
Мой проект не стал исключением, и использовал <Ext
href="https://go.dev/wiki/cgo">cgo</Ext> повсеместно. Но cgo -- это уже не Go,
что и стало, на мой взгляд, камнем преткновения.

Особенностью привязок является управление памятью, что особенно важно для GTK,
ведь весь тулкит построен вокруг подсчета ссылок -- основной задачей при
разработке привязок является правильное освобождение ресурсов.

В итоге вышло так, что все плюсы Go как языка были перевешены минусами,
связанными со спецификой проекта. На данный момент я приостановил разработку.

Тем не менее, этот проект дал мне большой опыт:

1. Прежде всего, он наглядно показывает очевидную вещь -- следует выбирать
подходящие под задачу инструменты.
2. Что не менее важно, мне удалось реализовать несколько
спецификаций. Некоторые из них реализовать было действительно непросто,
например, у себя в блоге я рассказывал о [реализации системного
трея](/blog/implementing-system-tray).
3. Наконец, были разработаны 4 библиотеки, связанные с функциональностью
рабочих столов.


## Дополнительные библиотеки

В рамках работы над окружением я провел исследования механизмов взаимодействия
компонентов рабочего стола, существующих протоколов и спецификаций, и
разработал ряд библиотек. Они реализуют функционал, который может быть
использован и за пределами проекта. Ниже перечислены некоторые из них:

- <Ext href="https://github.com/shelepuginivan/gotk3-session-lock">`gotk3-session-lock`</Ext> --
  привязки (bindings) Go для библиотеки
  <Ext href="https://github.com/Cu3PO42/gtk-session-lock">`gtk-session-lock`</Ext>,
  которая реализует протокол
  <Ext href="https://wayland.app/protocols/ext-session-lock-v1">`ext-session-lock-v1`</Ext>
  в GTK.

- <Ext href="https://github.com/shelepuginivan/systray">`systray`</Ext> --
  реализация спецификации
  <Ext href="https://www.freedesktop.org/wiki/Specifications/StatusNotifierItem/">StatusNotifierItem</Ext>,
  не зависящая от графических тулкитов.

- <Ext href="https://github.com/shelepuginivan/gotk3-vte">`gotk3-vte`</Ext> --
  привязки Go для библиотеки <Ext href="https://gitlab.gnome.org/GNOME/vte/">VTE</Ext>,
  которая позволяет отображать виртуальные терминалы как виджеты GTK.

- <Ext href="https://github.com/shelepuginivan/go-greetd">`go-greetd`</Ext> --
  реализация IPC-протокола <Ext
  href="https://git.sr.ht/~kennylevinsen/greetd">greetd</Ext>, позволяющая
  реализовывать собственные менеджеры дисплеев.

В конечном итоге можно считать, что я разработал набор десктопных библиотек для
Go. Хороший это результат, или плохой -- пусть каждый решит для себя сам.

## Демонстрация

Здесь представлены некоторые части окружения рабочего стола.

<Picture src={bar} alt="Панель">
    Панель (конфигурация и стили по умолчанию)
</Picture>

<Picture src={launch} alt="Меню запуска приложений">
    Меню запуска приложений (конфигурация и стили по умолчанию)
</Picture>

<Picture src={powermenu} alt="Меню питания">
    Меню питания (конфигурация и стили по умолчанию)
</Picture>
